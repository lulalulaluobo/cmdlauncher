# CmdLauncher 学习文档

面向已掌握 Python 基础、未接触 Qt 的学习者。本文件基于当前项目结构，提供技术栈概览、架构理解、学习路径与实操建议。

## 1. 技术栈与工具

- 语言：Python 3.14
- GUI 框架：PySide6（Qt 6 的官方 Python 绑定）
- 打包工具：PyInstaller（one-folder）
- 配置格式：JSON
- 日志：应用日志写入文件
- 运行平台：Windows

## 2. 项目目录结构

```
cmd_launcher/
  app.py                 # 程序入口
  core/                  # 核心逻辑（配置、模型、执行、日志）
  ui/                    # UI 组件（主窗体、参数弹窗、WiFi选择）
  config/                # commands.json（命令白名单）
  assets/                # 图标资源
  logs/                  # 运行日志
  dist/                  # 打包输出
  build/                 # 打包中间产物
```

## 3. 架构概览（你需要先理解的逻辑）

整体流程是：

1. `app.py` 启动应用
2. 读取配置（`config/commands.json`）生成命令列表
3. `MainWindow` 渲染按钮与说明
4. 点击按钮 -> 根据参数拼装命令 -> 执行 -> 输出到 UI + 记录日志
5. 托盘（右下角）提供 Show/Restart/Exit

这是一种典型的：

```
配置驱动 + UI 事件触发 + 命令执行 + 输出呈现
```

## 4. 关键模块说明

### 4.1 app.py（程序入口）

- 负责初始化 Qt 应用
- 读取配置
- 创建主窗口并显示
- 处理“重启”逻辑（退出码 1000）

### 4.2 core/config_loader.py（配置加载）

- 读取 `config/commands.json`
- 转换为 `CommandDefinition` 和 `ParamDefinition`
- 这让 UI 与命令逻辑解耦，便于扩展

### 4.3 core/command_runner.py（命令执行）

你要重点理解：

- 使用 `QProcess`/`subprocess` 运行系统命令
- 处理输出编码问题（自动/UTF-8）
- 超时控制与状态回调

### 4.4 ui/main_window.py（主窗口）

你要重点理解：

- Qt 布局：`QVBoxLayout` / `QHBoxLayout` / `QGridLayout`
- 控件：`QPushButton`、`QLabel`、`QPlainTextEdit`
- 事件：`button.clicked.connect(...)`
- 托盘：`QSystemTrayIcon`
- UI 与业务解耦：按钮只触发“命令执行逻辑”

### 4.5 ui/param_dialog.py（参数弹窗）

理解：

- 命令参数 UI 是动态生成的
- 参数类型和默认值由配置驱动

## 5. 配置驱动的核心：commands.json

你需要掌握这些字段：

- `id`：唯一标识
- `label`：按钮文字
- `description`：左侧说明
- `template`：命令模板（支持 `{param}`）
- `params`：参数定义
- `timeout`：超时秒数
- `admin`：是否需要管理员权限
- `kind`：`group` 表示分组标题

练习建议：自己新增一个命令，观察 UI 与执行输出如何变化。

## 6. Qt 学习路线（适合 Python 基础）

建议按这个顺序学习：

1. Qt 事件模型与信号/槽
   - 理解 `signal.connect(slot)` 机制
2. 基础控件
   - `QPushButton` `QLabel` `QLineEdit` `QPlainTextEdit`
3. 布局系统
   - `QVBoxLayout` `QHBoxLayout` `QGridLayout`
4. 窗口与对话框
   - `QMainWindow` `QDialog`
5. 资源与图标
   - `QIcon`、路径与打包
6. 进程执行与输出处理
   - `QProcess` / `subprocess`
7. 系统托盘
   - `QSystemTrayIcon`

## 7. 推荐学习任务（结合项目）

### 任务 1：增加一个命令

目标：理解配置驱动 UI

- 在 `config/commands.json` 加一条命令
- 设置 `label` 和 `template`
- 启动应用，确认新按钮出现并可执行

### 任务 2：加一个需要参数的命令

目标：理解参数弹窗

- 在命令里加入 `params`
- 使用 `{param}` 在 `template` 中引用

### 任务 3：调整 UI 结构

目标：理解布局系统

- 改变按钮和输出的比例
- 给按钮加统一样式

### 任务 4：改托盘行为

目标：理解系统托盘

- 在菜单里加“清空输出”
- 双击托盘显示/隐藏窗口

## 8. 打包与资源问题（你已经遇到的）

关键点：

- 打包时 `assets/` 必须包含在 datas 里
- 托盘图标不会热更新
- Windows 图标可能缓存，需要清理

当前 spec 里已加入：

- `('assets', 'assets')`

## 9. 常见问题排查思路

- UI 不显示：检查 `app.py` 是否报错，或依赖没装
- 按钮没反应：检查 `command_runner` 是否启动成功
- 输出乱码：切换“输出编码”为 UTF-8
- 图标不变：检查打包数据 + 清理图标缓存

## 10. 进阶扩展方向

- 增加命令分类搜索
- 记录命令执行历史
- 添加配置编辑器（UI 编辑 JSON）
- 支持自定义脚本执行

## 11. 学习资源建议（关键词）

你可以用这些关键词搜索：

- PySide6 信号与槽
- Qt 布局管理
- QSystemTrayIcon 示例
- QProcess 标准输出读取
- PyInstaller data 文件打包

---

给你一份“从零写”的步骤清单（含每步目标与验收点）。如果你补充每天可学习时长，我可以再拆成日程版。

从零开发步骤清单

Step 1：先定配置与需求

目标：确定最小可用功能与命令清单
输出文件：commands.json
验收：写 2~3 条命令（含 1 条带参数）
Step 2：定义数据模型

目标：把 JSON 变成结构化对象
输出文件：models.py
验收：能创建 CommandDefinition / ParamDefinition
Step 3：加载配置

目标：把 commands.json 读入内存
输出文件：config_loader.py
验收：打印/断点看到命令列表正确
Step 4：命令执行器

目标：统一命令执行、输出回调、超时控制
输出文件：command_runner.py
验收：能执行 ipconfig 并拿到输出
Step 5：主窗体骨架

目标：搭 UI 布局（按钮列 + 输出框）
输出文件：main_window.py
验收：窗口可显示，能看到静态按钮和输出区
Step 6：接通执行流程

目标：点击按钮 -> 执行命令 -> 输出到 UI
修改文件：main_window.py
验收：点击能输出命令结果
Step 7：参数弹窗

目标：支持带参数命令
输出文件：param_dialog.py
验收：点击带参数命令先弹窗，再执行
Step 8：日志记录

目标：持久化运行日志
输出文件：logger.py
验收：执行命令后日志写入 app.log
Step 9：托盘功能

目标：右下角托盘 Show/Restart/Exit
修改文件：main_window.py
验收：托盘菜单可用，双击可显示窗口
Step 10：编码与管理员

目标：输出编码切换 + 管理员重启
修改文件：main_window.py, command_runner.py
验收：UTF-8 切换可用；需要管理员时提示重启
Step 11：打包

目标：输出可分发的 exe
文件：cmd.spec
验收：cmd.exe 可运行且图标正确
如果你告诉我每天能学多久、目标周期（比如 1 周/2 周），我可以把上面拆成日程版步骤。

1 周

下面是 1 周学习/复盘计划（按每天 1~2 小时来拆）。如果你每天可用时间不同，我再按你节奏微调。

1 周日程

Day 1：需求与配置

目标：明确功能边界，写出 commands.json
验收：2~3 条命令 + 1 条带参数
Day 2：模型与配置加载

目标：写 models.py 和 config_loader.py
验收：能打印/调试看到命令列表对象
Day 3：命令执行器

目标：写 command_runner.py
验收：能执行 ipconfig 并返回输出
Day 4：主界面骨架

目标：完成 main_window.py 的布局
验收：窗口展示按钮列 + 输出框
Day 5：接通执行流程

目标：按钮点击触发执行并输出
验收：点击后 UI 输出正确
Day 6：参数弹窗与日志

目标：写 param_dialog.py + logger.py
验收：带参数命令可执行，日志落地
Day 7：托盘 + 打包

目标：托盘菜单 & PyInstaller
验收：托盘可用，cmd.exe 可运行且图标正确
如果你希望更“手把手”的日程（每天具体要写哪些函数、分几段练习），告诉我你每天能学的时长，我再细化。

## 附录 A：项目复盘模板（适合 PM）

你可以直接复制这段作为复盘模板：

```
# 项目复盘

## 1. 项目背景
- 业务背景：
- 用户痛点：
- 目标与范围：

## 2. 结果概览
- 交付内容：
- 关键指标（若有）：
- 结果结论（一句话）：

## 3. 做对了什么
- 

## 4. 没做好什么
- 

## 5. 根因分析
- 

## 6. 用户反馈/观察
- 

## 7. 风险与问题清单
- 

## 8. 下一步改进
- 

## 9. 经验沉淀
- 可复用做法：
- 需要避免的坑：
```

## 附录 B：PRD 模板（轻量）

```
# PRD - 功能名称

## 1. 背景与目标
- 背景：
- 目标：
- 不做什么（非目标）：

## 2. 用户画像与场景
- 目标用户：
- 典型场景：

## 3. 用户故事
- 作为 [用户]，我希望 [能力]，以便 [价值]

## 4. 功能范围
- 功能清单：
- 功能边界：

## 5. 交互与流程
- 关键流程：
- 关键界面：

## 6. 数据与日志
- 关键日志字段：
- 数据留存：

## 7. 权限与安全
- 权限要求：
- 误操作防护：

## 8. 异常与兜底
- 失败提示：
- 超时/权限/不可用处理：

## 9. 验收标准
- 功能验收：
- 异常验收：

## 10. 风险与依赖
- 风险：
- 依赖：

## 11. 里程碑
- 方案评审：
- 开发完成：
- 验收上线：
```

## 附录 C：风险清单模板

你可以直接用下面的表：

```
| 风险点 | 场景 | 影响 | 触发条件 | 规避/缓解 | 负责人 | 状态 |
| --- | --- | --- | --- | --- | --- | --- |
| 权限不足 | 需要管理员执行 | 功能失败 | 非管理员启动 | 提示并重启 | | |
| 命令超时 | 网络/系统慢 | 卡死/无响应 | 运行超过 X 秒 | 超时终止 | | |
| 输出乱码 | 系统编码不同 | 用户看不懂 | GBK/UTF-8 不一致 | 编码切换 | | |
| 误操作 | 清理/重启 | 数据丢失 | 用户点击误触 | 二次确认 | | |
```
